(function(a){a.widget("ui.treeinput",{options:{hiddenValue:""},_create:function(){var d=this,e=d.element;var h=a('<div class="input-append"/>');h.insertBefore(e);e.appendTo(h);var f=null;if(d.options.hiddenName&&d.options.hiddenName!=""){f=a('<input name="'+d.options.hiddenName+'" value="'+d.options.hiddenValue+'"  type="hidden"/>');f.appendTo(h)}var c=a('<div class="alert alert-info" style="display: none; position: absolute;margin: 0; padding: 0"/>');var g=a('<button type="button" class="close" data-dismiss="alert" style="right: 5px;top: 5px">X</button>').appendTo(c);g.click(function(){c.fadeOut("fast")});var b=a('<ul id="tree_'+(""+Math.random()).slice(-6)+'" class="ztree" style="margin-top: 0; width: 160px;"></ul>').appendTo(c);this.button=a('<span class="add-on"><i class="icon-arrow-down"></i></span>').attr("tabIndex",-1).attr("title","点击选取").appendTo(h).click(function(){if(a.trim(b.html())==""){var i=e[0];var l=i.offsetLeft;var k=i.offsetTop;var j=i.offsetParent;while(j!==null){l+=j.offsetLeft;j=j.offsetParent}a(c).css({left:l-1,top:k+e.outerHeight(),width:i.width});a.getJSON(d.options.url,function(m){a.fn.zTree.init(b,{view:{dblClickExpand:false},check:{enable:true,chkStyle:"radio",radioType:"all"},callback:{onCheck:function(s,u,t){var q=a.fn.zTree.getZTreeObj(u),p=q.getCheckedNodes(true);var o="";for(var r=0,n=p.length;r<n;r++){o+=p[r].name+","}if(o.length>0){o=o.substring(0,o.length-1)}e.attr("value",o);if(f!=null){o="";for(var r=0,n=p.length;r<n;r++){o+=p[r].id+","}if(o.length>0){o=o.substring(0,o.length-1)}f.attr("value",o)}c.fadeOut("fast")},onClick:function(o,q,p){var n=a.fn.zTree.getZTreeObj(q);n.checkNode(p,!p.checked,null,true);return false}}},m)})}a(c).toggle("fast");return false});c.appendTo(h)}})})(jQuery);