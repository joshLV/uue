(function(a){a.widget("ui.comboselect",{options:{delay:60,title:"展开",minLength:1,highlight:true,autoFocus:true},_create:function(){var f=this,c=f.element.hide(),e=c.children(":selected").eq(0),i=e[0]&&e.text()||"",h=e[0]&&e.val()||"";var b=c.attr("required");a.each(c.children("option"),function(){a(this).attr("pinyin",makePy(this.text))});var g=a('<div class="input-append"/>');g.insertBefore(c);var d=f.input=a("<input type='text' "+(c.attr("required")?" required='true' ":"")+"/>");d.val(i).addClass(c.attr("class")).appendTo(g).autocomplete({source:function(k,j){j(c.children("option").not(":disabled").map(function(){var m=this.text;var n=this.value;var l=a(this).attr("pinyin");if(this.value==""){return{label:"&nbsp;",value:this.value,option:this}}if(this.value&&(!k.term||m.toLowerCase().indexOf(k.term.toLowerCase())>=0||l.toLowerCase().indexOf(k.term.toLowerCase())>=0)){if(f.options.highlight&&k.term!=""){m=m.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+a.ui.autocomplete.escapeRegex(k.term)+")(?![^<>]*>)(?![^&;]+;)","gi"),"<strong><font color=red>$1</font></strong>")}return{label:m,value:this.text,option:this}}}))},select:function(j,k){c.val(k.item.option.text);k.item.option.selected=true;f._trigger("selected",j,{item:k.item.option});c.closest("form").attr("_inputChanged","true")},change:function(m,n){c.closest("form").attr("_inputChanged","true");var j=a(this),k=j.val(),l=false;if(a.isFunction(f.options.change)){f.options.change(c.val())}if(k==""){c.attr("selectedIndex",-1).val("");j.attr("title","");j.data("ui-autocomplete").term="";return false}c.children("option").each(function(){if(this.text===k){this.selected=l=true;return false}});if(!l){c.attr("selectedIndex",-1).val("");j.data("ui-autocomplete").term="";j.val("");return false}},delay:f.options.delay,minLength:f.options.minLength,autoFocus:f.options.autoFocus}).dblclick(function(){c.val("");d.val("");d.data("ui-autocomplete").term="";c.closest("form").attr("_inputChanged","true")});if(b){d.attr("required",b)}if(!jQuery.browser.msie){d[0].addEventListener("input",function(){var j=this.value;if(j){a(this).autocomplete("search",j)}},false)}d.focus(function(){a(this).select()});d.data("ui-autocomplete")._renderItem=function(j,k){return a("<li></li>").data("item.autocomplete",k).append("<a>"+k.label+"</a>").appendTo(j)};this.button=a('<span class="add-on"><i class="icon-arrow-down"></i></span>').attr("tabIndex",-1).attr("title",f.options.title).appendTo(g).click(function(){if(d.autocomplete("widget").is(":visible")){d.autocomplete("close");return false}a(this).blur();d.autocomplete("option","minLength",0);d.autocomplete("search","").focus();d.autocomplete("option","minLength",f.options.minLength);return false});e=i=h=null},_setOption:function(e,f){var d=this;var b=d.element,c=b.next();if(e=="size"){f=parseInt(f,10);c.attr("size",f)}else{if(e=="disabled"||e=="minLength"){this.input.autocomplete("option",e,f)}else{this.options[e]=f}}},destroy:function(){this.input.remove();this.button.remove();this.element.show();a.Widget.prototype.destroy.call(this)}})})(jQuery);